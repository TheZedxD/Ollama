<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama Chat Interface</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebar-toggle" onclick="toggleSidebar()">
            <span id="toggle-icon">â€¹</span>
        </button>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>OLLAMA</h1>
                <p>Local AI Interface</p>
            </div>

            <div class="sidebar-section">
                <label for="model-select">Model</label>
                <select id="model-select">
                    <option value="llama3.2:3b">llama3.2:3b</option>
                </select>
                <div class="sidebar-tooltip">Select which AI model to use for responses. Different models have different capabilities and sizes.</div>
            </div>

            <div class="sidebar-section">
                <label for="ollama-url">Ollama URL</label>
                <input type="text" id="ollama-url" value="http://localhost:11434" placeholder="http://localhost:11434">
                <div class="sidebar-tooltip">The network address where Ollama is running. Use localhost for local, or an IP address for remote connections.</div>
            </div>

            <div class="sidebar-section">
                <label for="temperature">Temperature</label>
                <input type="number" id="temperature" value="0.7" min="0" max="2" step="0.1">
                <div class="sidebar-tooltip">Controls creativity and randomness. Lower values (0.1-0.5) make responses more focused and deterministic. Higher values (0.8-2.0) make them more creative and varied.</div>
            </div>

            <div class="sidebar-section">
                <label for="max-tokens">Max Tokens</label>
                <input type="number" id="max-tokens" value="2048" min="1" max="131072" step="1">
                <div class="sidebar-tooltip">Maximum number of tokens to generate in the response. Higher values allow longer responses but take more time.</div>
            </div>

            <div class="sidebar-section">
                <label for="top-p">Top P</label>
                <input type="number" id="top-p" value="0.9" min="0" max="1" step="0.05">
                <div class="sidebar-tooltip">Nucleus sampling. Only the smallest set of most probable tokens with probabilities that add up to top_p or higher are kept for generation.</div>
            </div>

            <div class="sidebar-section">
                <label for="top-k">Top K</label>
                <input type="number" id="top-k" value="40" min="1" max="100" step="1">
                <div class="sidebar-tooltip">Limits the next token selection to the K most probable tokens.</div>
            </div>

            <div class="sidebar-section">
                <label for="repeat-penalty">Repeat Penalty</label>
                <input type="number" id="repeat-penalty" value="1.1" min="0" max="2" step="0.1">
                <div class="sidebar-tooltip">Penalizes repetitive text. Higher values (1.2-1.5) reduce repetition more strongly.</div>
            </div>

            <div class="sidebar-section">
                <label for="system-prompt">System Prompt</label>
                <input type="text" id="system-prompt" placeholder="You are a helpful assistant">
                <div class="sidebar-tooltip">Set the AI's behavior and personality. This instruction guides how the AI responds throughout the conversation.</div>
            </div>

            <button class="button" onclick="refreshModels()">Refresh Models</button>
            <button class="button button-secondary" onclick="clearChat()">Clear Chat</button>

            <div class="status-indicator">
                <div class="status-dot" id="status-dot"></div>
                <span id="status-text">Disconnected</span>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-content">
            <div class="chat-header">
                <h2>CHAT INTERFACE</h2>
                <button class="theme-toggle" onclick="toggleTheme()">Light/Dark</button>
            </div>

            <div class="chat-messages" id="chat-messages">
            </div>

            <div class="chat-input-container">
                <!-- Tools Popup -->
                <div class="tools-popup" id="tools-popup">
                    <div class="tools-popup-header">
                        <h3>Tools & Settings</h3>
                        <button class="close-popup" onclick="toggleToolsPopup()">Ã—</button>
                    </div>
                    <div class="tools-list">
                        <div class="tool-item" onclick="toggleTool('web-search')">
                            <div class="tool-checkbox" id="tool-web-search"></div>
                            <div class="tool-label">Web Search</div>
                            <div class="tool-tooltip">Enable web search capabilities</div>
                        </div>
                        <div class="tool-item" onclick="toggleTool('file-analysis')">
                            <div class="tool-checkbox" id="tool-file-analysis"></div>
                            <div class="tool-label">File Analysis</div>
                            <div class="tool-tooltip">Analyze uploaded files (TXT, PDF, JSON, CSV, MD)</div>
                        </div>
                    </div>
                    <div class="tools-settings">
                        <h4>File Analysis Settings</h4>
                        <div class="setting-item" onclick="toggleSetting('auto-clear-file')">
                            <div class="tool-checkbox" id="setting-auto-clear-file"></div>
                            <div class="tool-label">Auto-clear after analysis</div>
                            <div class="tool-tooltip">Automatically remove the file after successful analysis</div>
                        </div>
                    </div>
                </div>

                <div class="typing-indicator" id="typing-indicator">AI is thinking...</div>

                <!-- Image Preview -->
                <div class="image-preview" id="image-preview" style="display: none;">
                    <img id="preview-img" src="" alt="Preview">
                    <button class="remove-image" onclick="removeImage()">Ã—</button>
                </div>

                <!-- File Preview -->
                <div class="file-preview" id="file-preview" style="display: none;">
                    <div class="file-preview-content">
                        <span class="file-icon">ðŸ“„</span>
                        <span class="file-name" id="file-name"></span>
                        <span class="file-size" id="file-size"></span>
                    </div>
                    <button class="remove-file" onclick="removeFile()">Ã—</button>
                </div>

                <div class="chat-input-wrapper">
                    <button class="tools-button" onclick="toggleToolsPopup()">
                        +
                        <span class="tools-badge" id="tools-badge">0</span>
                    </button>
                    <!-- Image Upload Button (hidden by default) -->
                    <button class="image-button" id="image-button" onclick="document.getElementById('image-input').click()" style="display: none;">
                        ðŸ“·
                    </button>
                    <input type="file" id="image-input" accept="image/*" onchange="handleImageUpload(event)" style="display: none;">
                    <!-- File Upload Button (shown when file analysis is enabled) -->
                    <button class="file-button" id="file-button" onclick="document.getElementById('file-input').click()" style="display: none;" title="Upload a file for analysis">
                        ðŸ“Ž
                        <span class="file-ready-badge" id="file-ready-badge" style="display: none;">âœ“</span>
                    </button>
                    <input type="file" id="file-input" accept=".txt,.pdf,.json,.csv,.md,.js,.py,.java,.c,.cpp,.html,.css,.xml,.yaml,.yml" onchange="handleFileUpload(event)" style="display: none;">
                    <textarea
                        class="chat-input"
                        id="chat-input"
                        placeholder="Type your message here..."
                        onkeydown="handleKeyPress(event)"></textarea>
                    <div class="thinking-animation" id="thinking-animation">
                        <div class="wifi-wave"></div>
                        <div class="wifi-wave"></div>
                        <div class="wifi-wave"></div>
                    </div>
                    <button class="send-button" id="send-button" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
